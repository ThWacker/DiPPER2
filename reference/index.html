
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://thwacker.github.io/DiPPER2/reference/">
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.46">
    
    
      
        <title>Reference - DiPPER2 documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#key-functions-of-dipper" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DiPPER2 documentation" class="md-header__button md-logo" aria-label="DiPPER2 documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DiPPER2 documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DiPPER2 documentation" class="md-nav__button md-logo" aria-label="DiPPER2 documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DiPPER2 documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="key-functions-of-dipper">Key Functions of DiPPER</h1>
<h1 id="key-functions-of-target_move_module_optimized">Key Functions of target_move_module_optimized</h1>


<div class="doc doc-object doc-module">



<a id="scripts.target_move_module_optimized"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="scripts.target_move_module_optimized.move_remaining_files_to_neighbour" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">move_remaining_files_to_neighbour</span><span class="p">(</span><span class="n">source_folder</span><span class="p">,</span> <span class="n">fur_target_folder</span><span class="p">,</span> <span class="n">fur_neighbour_folder</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Move remaining files to the neighbour folder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the folder with all results of this run</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fur_target_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>folder with the target accession assemblies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fur_neighbour_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the folder with the neighbour accession assemblies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging_handler.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the logger</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/target_move_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">move_remaining_files_to_neighbour</span><span class="p">(</span><span class="n">source_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fur_target_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">fur_neighbour_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span><span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move remaining files to the neighbour folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_folder (Path): the folder with all results of this run</span>
<span class="sd">        fur_target_folder (Path): folder with the target accession assemblies</span>
<span class="sd">        fur_neighbour_folder (Path): the folder with the neighbour accession assemblies</span>
<span class="sd">        logger (Logger): the logger</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">source_folder</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fur_target_folder</span> <span class="o">/</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fasta&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fa&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span> <span class="p">(</span><span class="s2">&quot;.fna&quot;</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">fur_neighbour_folder</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copied to </span><span class="si">{</span><span class="n">fur_neighbour_folder</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a fasta file. Skipping.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> already exists in </span><span class="si">{</span><span class="n">fur_target_folder</span><span class="si">}</span><span class="s1">, skipping.&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.target_move_module_optimized.parse_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_list</span><span class="p">(</span><span class="n">targets_file</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse the list of targets from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>targets_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a file with a list of targets</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of Accessions with the version number stripped off</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/target_move_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_list</span><span class="p">(</span><span class="n">targets_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the list of targets from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        targets_file (Path): a file with a list of targets</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of Accessions with the version number stripped off</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">targets_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Target file &#39;</span><span class="si">{</span><span class="n">targets_file</span><span class="si">}</span><span class="s2">&#39; not found!: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Target file &#39;</span><span class="si">{</span><span class="n">targets_file</span><span class="si">}</span><span class="s2">&#39; not found!: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.target_move_module_optimized.process_target_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_target_files</span><span class="p">(</span><span class="n">list_targets</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">fur_target_folder</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Process each target file based on the list of targets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>list_targets</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list with the target accessions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a path object of the folder to rule them all (all results of this DiPPER2 run are in this folder)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fur_target_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target folder the accessions that are targets will be copiedn in. </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="logging_handler.Logger">Logger</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the logger</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/target_move_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_target_files</span><span class="p">(</span><span class="n">list_targets</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">:</span><span class="n">Path</span><span class="p">,</span> <span class="n">fur_target_folder</span><span class="p">:</span><span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process each target file based on the list of targets.</span>

<span class="sd">    Args:</span>
<span class="sd">        list_targets (list): The list with the target accessions</span>
<span class="sd">        source_folder (Path): a path object of the folder to rule them all (all results of this DiPPER2 run are in this folder)</span>
<span class="sd">        fur_target_folder (Path): the target folder the accessions that are targets will be copiedn in. </span>
<span class="sd">        logger (Logger): the logger</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        RunTimeError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">accession</span> <span class="ow">in</span> <span class="n">list_targets</span><span class="p">:</span>
        <span class="n">accession_pattern</span> <span class="o">=</span> <span class="n">accession</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;find&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_folder</span><span class="p">),</span> <span class="s1">&#39;-maxdepth&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;-type&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;-iname&#39;</span><span class="p">,</span> <span class="n">accession_pattern</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">test_list</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Make sure that there is only one assembly per accession. Please delete the other assemblies and only keep the highest quality one.&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fasta&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fa&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fna&quot;</span><span class="p">):</span>
                    <span class="n">target_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_file</span><span class="si">}</span><span class="s2"> will be copied to </span><span class="si">{</span><span class="n">fur_target_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">fur_target_folder</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is not a fasta file. Skipping.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">accession_pattern</span><span class="si">}</span><span class="s2"> not found! Are you in the folder with the assemblies? Please double-check!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding file </span><span class="si">{</span><span class="n">accession_pattern</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error finding </span><span class="si">{</span><span class="n">accession_pattern</span><span class="si">}</span><span class="s2"> or copying the file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="key-functions-of-fur_module_optimized">Key Functions of FUR_module_optimized</h2>


<div class="doc doc-object doc-module">



<a id="scripts.FUR_module_optimized"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="scripts.FUR_module_optimized.check_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_folders</span><span class="p">(</span><span class="o">*</span><span class="n">folders</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if folders exist and are non-empty.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folders</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path object(s) of one or more folders</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/FUR_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_folders</span><span class="p">(</span><span class="o">*</span><span class="n">folders</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span><span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if folders exist and are non-empty.</span>

<span class="sd">    Args:</span>
<span class="sd">        folders (Path): path object(s) of one or more folders</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.FUR_module_optimized.clean_up" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_up</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Clean up temporary files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the FUR database</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/FUR_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_up</span><span class="p">(</span><span class="n">db</span><span class="p">:</span><span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean up temporary files.</span>

<span class="sd">    Args:</span>
<span class="sd">        db (Path): the FUR database</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The directory </span><span class="si">{</span><span class="n">db</span><span class="si">}</span><span class="s2"> has been deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.FUR_module_optimized.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>The main function of the FUR module that is called by the wrapper. 
Requires a folder, has defaults for everything else.</p>

            <details class="quote">
              <summary>Source code in <code>scripts/FUR_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main function of the FUR module that is called by the wrapper. </span>
<span class="sd">    Requires a folder, has defaults for everything else. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">dt_string</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y_%Hh%Mmin%Ss_%z&quot;</span><span class="p">)</span>
    <span class="c1">#Parse all arguments</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s2">&quot;DiPPER2&quot;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;This module runs FUR to find unique genomic regions&#39;</span><span class="p">,</span> <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;Bugs, suggestions, criticism, chocolate, puppies and praise to t.wacker2@exeter.ac.uk&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--parameter&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Tells FUR how to run. -u -&gt; only the first subtraction step; -U -&gt; runs first Subtraction step and Intersection step; -m -&gt; runs megablast instead of blastn in the last step; without argument runs FUR in full.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--outfile_prefix&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">dt_string</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Outfile prefix. Default is date and time in d-m-y-h-m-s-tz format&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(prog)s</span><span class="s1"> 0.0.1&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--folder&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Results folder name, which includes results folders from previous steps&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--reference&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;Optional reference for the makeFurDb step&quot;</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-V&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;increase logging verbosity&quot;</span>
    <span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># find the source folder, define the FUR.target and FUR.neighbour folders</span>
    <span class="n">source_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">target_folder</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.target&quot;</span>
    <span class="n">neighbour_folder</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.neighbour&quot;</span>

    <span class="c1"># configures the logger</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
    <span class="n">logger_instance</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logger_instance</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>

    <span class="c1"># Basic info</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The parameters are:</span><span class="se">\n</span><span class="s1"> for the FUR parameter </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">parameter</span><span class="si">}</span><span class="se">\n</span><span class="s1"> for the outfile prefix: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">outfile_prefix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1">#check if they exist</span>
    <span class="n">check_folders</span><span class="p">(</span><span class="n">target_folder</span><span class="p">,</span> <span class="n">neighbour_folder</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="c1"># run makefurdb</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reference</span><span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">reference</span>
            <span class="n">make_fur_db</span><span class="p">(</span><span class="n">target_folder</span><span class="p">,</span> <span class="n">neighbour_folder</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find file </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s2">. Defaulting to running without a reference&quot;</span><span class="p">)</span>
            <span class="n">make_fur_db</span><span class="p">(</span><span class="n">target_folder</span><span class="p">,</span> <span class="n">neighbour_folder</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">make_fur_db</span><span class="p">(</span><span class="n">target_folder</span><span class="p">,</span> <span class="n">neighbour_folder</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1">#run fur</span>
    <span class="n">fur_out</span> <span class="o">=</span> <span class="n">run_fur</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">parameter</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">outfile_prefix</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1">#print the stats to stderr &amp; save in file(might not want that on server)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fur_out</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fur_file</span><span class="o">=</span> <span class="n">source_folder</span><span class="o">/</span> <span class="s2">&quot;FUR_Summary_output.txt&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fur_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fur_out</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not open or write the FUR summary output to </span><span class="si">{</span><span class="n">fur_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">e</span><span class="p">})</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not open or write the FUR summary output to </span><span class="si">{</span><span class="n">fur_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>



    <span class="c1"># clean up after yourself</span>
    <span class="n">clean_up</span><span class="p">(</span><span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.db&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1">#Heureka</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FUR_module.py ran to completion: exit status 0&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.FUR_module_optimized.make_fur_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_fur_db</span><span class="p">(</span><span class="n">target_folder</span><span class="p">,</span> <span class="n">neighbour_folder</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create the FUR database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the folder with the target accessions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbour_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the folder with the neighbour accessions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one folder to rule them all (the folder with all results from DiPPER2 run)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/FUR_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_fur_db</span><span class="p">(</span><span class="n">target_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">neighbour_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the FUR database.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_folder (Path): the folder with the target accessions</span>
<span class="sd">        neighbour_folder (Path): the folder with the neighbour accessions</span>
<span class="sd">        source (Path): one folder to rule them all (the folder with all results from DiPPER2 run)</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises: </span>
<span class="sd">        RunTimeError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Making FUR DB.&quot;</span><span class="p">)</span>
        <span class="n">fur_db</span> <span class="o">=</span> <span class="n">source</span> <span class="o">/</span> <span class="s1">&#39;FUR.db&#39;</span>
        <span class="k">if</span> <span class="n">reference</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;makeFurDb&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_folder</span><span class="p">),</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">neighbour_folder</span><span class="p">),</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fur_db</span><span class="p">),</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">reference</span><span class="p">)],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;makeFurDb&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_folder</span><span class="p">),</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">neighbour_folder</span><span class="p">),</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fur_db</span><span class="p">)],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error when executing makeFurDb: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error when executing makeFurDb: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.FUR_module_optimized.run_fur" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_fur</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">outfile_prefix</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Run the FUR command and handle the output.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>option</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one of the flags from FUR (u, U or m)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outfile_prefix</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the outfile prefix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one folder to rule them all (the folder with all results from this DiPPER2 run)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The StdErr output of FUR, which contains basic stats. </p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/FUR_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_fur</span><span class="p">(</span><span class="n">option</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">outfile_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the FUR command and handle the output.</span>

<span class="sd">    Args: </span>
<span class="sd">        option (str): one of the flags from FUR (u, U or m)</span>
<span class="sd">        outfile_prefix (str): the outfile prefix</span>
<span class="sd">        source (Path): one folder to rule them all (the folder with all results from this DiPPER2 run)</span>

<span class="sd">    Returns:</span>
<span class="sd">        The StdErr output of FUR, which contains basic stats. </span>

<span class="sd">    Raises:</span>
<span class="sd">        RunTimeError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">option_flag</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="n">option</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">fur_out</span> <span class="o">=</span> <span class="n">source</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outfile_prefix</span><span class="si">}</span><span class="s2">_FUR.db.out.txt&quot;</span>
    <span class="n">fur_db</span> <span class="o">=</span> <span class="n">source</span> <span class="o">/</span> <span class="s1">&#39;FUR.db&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running FUR.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;fur&#39;</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fur_db</span><span class="p">),</span> <span class="n">option_flag</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fur_output</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">error</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FUR did not run to completion and a Runtime Error occured: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FUR did not run to completion and a Runtime Error occured: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="n">fur_out</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">fur_output</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span> <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fur_out</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">fur_out</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fur could not find unique regions or did not run successfully. </span><span class="si">{</span><span class="n">fur_out</span><span class="si">}</span><span class="s2"> is empty or does not exist.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">error</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="key-functions-of-primer3_module_optimized">Key Functions of Primer3_module_optimized</h2>


<div class="doc doc-object doc-module">



<a id="scripts.Primer3_module_optimized"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="scripts.Primer3_module_optimized.find_and_return_following_lines_and_target" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_and_return_following_lines_and_target</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">top_lines</span><span class="p">,</span> <span class="n">qpcr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Find the primer penalty and return following lines aka primers and targets for the top primer penalties.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the primer3 output file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_lines</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list with the 4 lowest primer penalties</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qPCR</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>yes/no toggle to decide if internal probe is also returned or not</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>found_data</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary containing primers and targets, as well as data (Tm etc.) of primers</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer3_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_and_return_following_lines_and_target</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">qpcr</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the primer penalty and return following lines aka primers and targets for the top primer penalties.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str): the primer3 output file</span>
<span class="sd">        top_lines (list): list with the 4 lowest primer penalties</span>
<span class="sd">        qPCR (str): yes/no toggle to decide if internal probe is also returned or not</span>

<span class="sd">    Returns:</span>
<span class="sd">        found_data (dict): a dictionary containing primers and targets, as well as data (Tm etc.) of primers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#initialize dictionary</span>
    <span class="n">found_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># Iterate over each &#39;top_line&#39; in &#39;top_lines&#39;</span>
    <span class="k">for</span> <span class="n">top_line</span> <span class="ow">in</span> <span class="n">top_lines</span><span class="p">:</span>
        <span class="c1"># Join the elements of &#39;top_line&#39; with an equals sign (&#39;=&#39;) between them</span>
        <span class="n">joined_top_line</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_line</span><span class="p">)</span>

        <span class="c1"># Check if &#39;qpcr&#39; is equal to &#39;y&#39; (yes) to determine the flow of processing</span>
        <span class="k">if</span> <span class="n">qpcr</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="c1"># Iterate over the &#39;lines&#39; list and enumerate them to get both index and content</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="c1"># If the &#39;joined_top_line&#39; is found in the current line</span>
                <span class="k">if</span> <span class="n">joined_top_line</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="c1"># Retrieve the target sequence from 5 lines above the current one</span>
                    <span class="n">target_sequence</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c1"># Extract primer sequences from lines 4 to 6 after the current line</span>
                    <span class="n">primer_sequences</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="c1"># Extract additional primer data from lines 7 to 29 after the current line</span>
                    <span class="n">primer_data</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="c1"># Store the found data in the &#39;found_data&#39; dictionary with dynamic keys</span>
                    <span class="n">found_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Target_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_sequence</span>
                    <span class="n">found_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Primer_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primer_sequences</span>
                    <span class="n">found_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Data_primer_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primer_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If &#39;qpcr&#39; is not &#39;y&#39;, follow a different data extraction process that takes care of the </span>
            <span class="c1"># fact that internal probe is not part of primer3 output. Set to NA instead. </span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="c1"># If the &#39;joined_top_line&#39; is found in the current line</span>
                <span class="k">if</span> <span class="n">joined_top_line</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="c1"># Retrieve the target sequence from 5 lines above the current one</span>
                    <span class="n">target_sequence</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c1"># Extract primer sequences from lines 3 to 4 after the current line</span>
                    <span class="n">primer_sequences</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="c1"># Append a placeholder for a missing primer sequence when &#39;qpcr&#39; is not &#39;y&#39;</span>
                    <span class="n">primer_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PRIMER_INTERNAL_0_SEQUENCE=NA&quot;</span><span class="p">)</span>
                    <span class="c1"># Extract additional primer data from lines 5 to 21 after the current line</span>
                    <span class="n">primer_data</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="c1"># Store the found data in the &#39;found_data&#39; dictionary with dynamic keys</span>
                    <span class="n">found_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Target_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_sequence</span>
                    <span class="n">found_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Primer_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primer_sequences</span>
                    <span class="n">found_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Data_primer_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">primer_data</span>

    <span class="c1"># Return the &#39;found_data&#39; dictionary containing all the extracted information</span>
    <span class="k">return</span> <span class="n">found_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer3_module_optimized.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>main function doing too much at the moment.
tbc</p>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer3_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    main function doing too much at the moment.</span>
<span class="sd">    tbc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">dt_string</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y_%Hh%Mmin%Ss_%z&quot;</span><span class="p">)</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;primer3core module of DiPPER2&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Please ensure that primer3 is found in path&quot;</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;Theresa Wacker T.Wacker2@exeter.ac.uk&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--parameter&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;primMinTm=58 primOptTm=60 primMaxTm=62 inMinTm=63 inOptTm=65 inMaxTm=67 prodMinSize=100 prodMaxSize=200 Oligo=1&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;string from config file that defines the primer3_core parameters for fur2prim. Default: primMinTm=58 primOptTm=60 primMaxTm=62 inMinTm=63 inOptTm=65 inMaxTm=67 prodMinSize=100 prodMaxSize=200&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(prog)s</span><span class="s2"> 0.1.0-beta&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--outfile_prefix&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">dt_string</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Outfile prefix. Default is date and time in d-m-y-h-m-s-tz format&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--folder&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Results folder name, which includes results folders from previous steps&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--qpcr&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Toggle whether to expect an internal probe sequence (qPCR) or not. Default is no(n).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-V&#39;</span><span class="p">,</span> <span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;increase logging verbosity&quot;</span> <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># set source folder</span>
    <span class="n">source_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>

    <span class="c1"># configures the logger</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
    <span class="n">logger_instance</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logger_instance</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>

    <span class="c1"># info</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting the Primer3 module...&quot;</span><span class="p">)</span>

    <span class="c1"># change into the folder</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">source_folder</span><span class="p">)</span>

    <span class="c1"># looks for all FUR.db.out.txt files, but should only find one. However, it should not find none.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">source_folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*FUR.db.out.txt&quot;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">StopIteration</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not find </span><span class="si">{target}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">(</span>
            <span class="s2">&quot;Exception while trying to find the outfile of the FUR_module.py FUR.db.out.txt.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># check if there is the right number of parameters that are supposed to be fed into fur2prim</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">parameter</span><span class="si">}</span><span class="s2"> does not have 9 elements. You must define all changed values: primMinTm, primOptTm, primMaxTm, inMinTm, inOptTm, inMaxTm, prodMinSize=100, prodMaxSize=200 and Oligo=1&quot;</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c1"># convert fur output into primer3 compatible output using the functions from the fur2primer3 script</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Convert the FUR output to Primer3 compatible output using fur2primer3 functions...&quot;</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># parse parameters (dictionary)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">args_to_dict</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">parameter</span><span class="p">)</span>
        <span class="c1"># remap/ convert parameter keys to Primer3 conventions</span>
        <span class="n">form_param</span> <span class="o">=</span> <span class="n">remap_keys</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="c1"># write Primer3 compatible file.</span>
        <span class="n">write_result</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">form_param</span><span class="p">)</span>

    <span class="c1"># Error handling</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not find </span><span class="si">{target}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input or output values are not as expected: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input or output values are not as expected: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Wrong type&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrong type: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write or open file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write or open file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown exception occured while running fur2primer3 functions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown exception occured while running fur2primer3 functions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># define results file</span>
    <span class="n">resultf2p</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.primers.txt&quot;</span><span class="p">)</span>

    <span class="c1"># check if the results file is empty, if so sys.exit 1 with message (might not raise correct exception)</span>
    <span class="k">if</span> <span class="n">resultf2p</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resultf2p</span><span class="si">}</span><span class="s2"> is empty.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c1"># try running primer3_core, write it to file, check if the file exists and/or is empty. If so,</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running primer3_core.&quot;</span><span class="p">)</span>
        <span class="n">primer3</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;primer3_core&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resultf2p</span><span class="p">)],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Primer 3 did not run successfully.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
            <span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># write the resulyts of the primer3 run to a file</span>
    <span class="n">resultp3</span> <span class="o">=</span> <span class="n">resultf2p</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.primer3_out.txt&quot;</span><span class="p">)</span>
    <span class="n">resultp3</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">primer3</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

    <span class="c1"># complain about no results and raise exception</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resultp3</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">resultp3</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Primer3 did not manage to generate primers or did not run successfully. </span><span class="si">{resultp3}</span><span class="s2"> does not exist or is empty.&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Primer3 did not manage to generate primers or did not run successfully. </span><span class="si">{</span><span class="n">resultp3</span><span class="si">}</span><span class="s2"> does not exist or is empty.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># parse primer3 output and find the 4 lowest penalty scores.</span>
    <span class="n">top_4_lines</span> <span class="o">=</span> <span class="n">parse_primers</span><span class="p">(</span><span class="n">resultp3</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The top 4 lowest primer penalties are:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">top_4_lines</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

    <span class="c1"># Inform the user that we are not extracting primers and targets for the lowest penalties</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieving primers and targets for the lowest penalties...&quot;</span><span class="p">)</span>

    <span class="c1"># get a dictionary that contains the primers and the data. Primers and targets are identified by the line in the primer3 output their corresponding lowest penalty score is found at</span>
    <span class="n">found_data</span> <span class="o">=</span> <span class="n">find_and_return_following_lines_and_target</span><span class="p">(</span>
        <span class="n">resultp3</span><span class="p">,</span> <span class="n">top_4_lines</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">qpcr</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The resulting targets and primers are:&quot;</span><span class="p">)</span>

    <span class="c1"># Iterate over the items (key-value pairs) in the &#39;found_data&#39; dictionary</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">found_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Log the current key-value pair</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check if the current key is related to &quot;Primer&quot; by checking if the string &quot;Primer&quot; is in the key</span>
        <span class="n">is_primer</span> <span class="o">=</span> <span class="s2">&quot;Primer&quot;</span> <span class="ow">in</span> <span class="n">key</span>

        <span class="c1"># Define the name of the temporary file where the data will be written</span>
        <span class="n">temp_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">outfile_prefix</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">.txt&quot;</span>

        <span class="c1"># Open the temporary file for writing with UTF-8 encoding</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
            <span class="c1"># If the current key is related to primer data</span>
            <span class="k">if</span> <span class="n">is_primer</span><span class="p">:</span>
                <span class="c1"># Iterate through each element in the value (which should be a list of primer data)</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="c1"># Split the element by &#39;=&#39; and remove unnecessary whitespace around it</span>
                    <span class="n">split_lines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*=\s*&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                    <span class="c1"># If the split results in at least two parts (a name and a sequence)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_lines</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># Write the primer data to the file in the format &quot;&gt;name\nsequence\n&quot;</span>
                        <span class="n">tf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">split_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">split_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># If the key contains &quot;Data&quot; (indicating it&#39;s data-related)</span>
            <span class="k">elif</span> <span class="s2">&quot;Data&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="c1"># Write all the data (joined with newlines) to the file</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="c1"># For other cases (non-primer, non-data)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Split the value by &#39;=&#39; and remove whitespace</span>
                <span class="n">split_line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*=\s*&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="c1"># If the split results in at least two parts (a name and a sequence)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># Write the name and sequence to the file in the format &quot;&gt;name\nsequence\n&quot;</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">split_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">split_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Define the paths for the destination folders where files will be moved</span>
    <span class="n">destination_folder_pr</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.P3.PRIMERS&quot;</span>
    <span class="n">destination_folder_tar</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.P3.TARGETS&quot;</span>
    <span class="n">destination_folder_data</span> <span class="o">=</span> <span class="n">destination_folder_pr</span> <span class="o">/</span> <span class="s2">&quot;primer_data&quot;</span>

    <span class="c1"># Create the destination folders if they don&#39;t already exist</span>
    <span class="n">destination_folder_pr</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">destination_folder_tar</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">destination_folder_data</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Move files with specific patterns from the source folder to the appropriate destination folders</span>
    <span class="n">move_files</span><span class="p">(</span><span class="n">source_folder</span><span class="p">,</span> <span class="n">destination_folder_tar</span><span class="p">,</span> <span class="s2">&quot;*Target*.txt&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">move_files</span><span class="p">(</span><span class="n">source_folder</span><span class="p">,</span> <span class="n">destination_folder_pr</span><span class="p">,</span> <span class="s2">&quot;*Primer*.txt&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="n">move_files</span><span class="p">(</span><span class="n">source_folder</span><span class="p">,</span> <span class="n">destination_folder_data</span><span class="p">,</span> <span class="s2">&quot;*Data*.txt&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Log that the script has completed successfully</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Primer3_module.py ran to completion: exit status 0&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer3_module_optimized.move_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">move_files</span><span class="p">(</span><span class="n">source_folder</span><span class="p">,</span> <span class="n">destination_folder</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Move files matching pattern from source_folder to destination_folder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path object containing the files that are supposed to be moved into the destination folder</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destination_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path object the files are supposed to be shifted to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pattern to be matched to identify which files from the source folder go into the destination folder</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer3_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">move_files</span><span class="p">(</span><span class="n">source_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">destination_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move files matching pattern from source_folder to destination_folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_folder (Path): Path object containing the files that are supposed to be moved into the destination folder</span>
<span class="sd">        destination_folder (Path): Path object the files are supposed to be shifted to</span>
<span class="sd">        pattern (str): pattern to be matched to identify which files from the source folder go into the destination folder</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">source_folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files matching </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> found in </span><span class="si">{</span><span class="n">source_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files matching </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> found in </span><span class="si">{</span><span class="n">source_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">destination_folder</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moved </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">destination_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error moving files&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error moving files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OS error during moving files with shutil.move: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;OS error during shutil.move&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer3_module_optimized.parse_primers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_primers</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse the primer penalties from the file and return the top lines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the file name of the primer3 output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sorted_lines</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the first 4 elements of a list of penalty sorted incrementally</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer3_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_primers</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the primer penalties from the file and return the top lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str): the file name of the primer3 output</span>

<span class="sd">    Returns:</span>
<span class="sd">        sorted_lines (list): the first 4 elements of a list of penalty sorted incrementally</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># if line with PRIMER_PAIR_0_PENALTY is found, put in list</span>
    <span class="n">filtered_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="s2">&quot;PRIMER_PAIR_0_PENALTY&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>

    <span class="c1"># This line processes each line in &#39;filtered_lines&#39; by stripping whitespace and splitting </span>
    <span class="c1"># it into two parts at the first occurrence of the &#39;=&#39; symbol. The result is a list of lists,</span>
    <span class="c1"># where each sublist contains the parts of the line before and after the &#39;=&#39;. The regular </span>
    <span class="c1"># expression &#39;r&quot;\s*=\s*&quot;&#39; ensures that any surrounding whitespace around the &#39;=&#39; is ignored.</span>
    <span class="n">split_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*=\s*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filtered_lines</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Attempt to sort &#39;split_lines&#39; by the second element in each sublist (x[1]), converting it to a float</span>
        <span class="n">sorted_lines</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">split_lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># If a ValueError occurs during sorting (e.g., non-numeric data), log the error with exception info</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error in sorting lines&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Raise a new ValueError, preserving the original exception details</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in sorting lines: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># If the sorted list is empty, log an error indicating no primers were found</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sorted_lines</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error: No primers found in file&quot;</span><span class="p">)</span>
        <span class="c1"># Raise an exception because no valid data was found to return</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error: No primers found in file&quot;</span><span class="p">)</span>

    <span class="c1"># Return the first 4 items from the sorted list</span>
    <span class="k">return</span> <span class="n">sorted_lines</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="key-functions-of-primer_testing_module_optimized">Key Functions of Primer_Testing_module_optimized</h2>


<div class="doc doc-object doc-module">



<a id="scripts.Primer_Testing_module_optimized"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.check_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_folders</span><span class="p">(</span><span class="o">*</span><span class="n">folders</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if folders exist and are non-empty.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folders</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path object(s) of one or more folders</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_folders</span><span class="p">(</span><span class="o">*</span><span class="n">folders</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span><span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if folders exist and are non-empty.</span>

<span class="sd">    Args:</span>
<span class="sd">        folders (Path): path object(s) of one or more folders</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.check_program_installed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_program_installed</span><span class="p">(</span><span class="n">program</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if a program is installed and available in the PATH.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>programm</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the program to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_program_installed</span><span class="p">(</span><span class="n">program</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a program is installed and available in the PATH.</span>

<span class="sd">    Args:</span>
<span class="sd">        programm (str): the program to check</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># which is a tool in shutil.</span>
    <span class="k">return</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">program</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.concat_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">concat_files</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Concatenate the content of all files found in a folder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a path object of the folder which contains the fastas to be concatenated</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target or neighbour</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path object to the folder that rules it all (the results folder of this DiPPER2 run)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the filename of the concatenated fasta file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no files were found or no data was written to the output file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">concat_files</span><span class="p">(</span><span class="n">folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Concatenate the content of all files found in a folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder (Path): a path object of the folder which contains the fastas to be concatenated</span>
<span class="sd">        name (str): target or neighbour</span>
<span class="sd">        source (Path): Path object to the folder that rules it all (the results folder of this DiPPER2 run)</span>

<span class="sd">    Returns:</span>
<span class="sd">        the filename of the concatenated fasta file</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If no files were found or no data was written to the output file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create output file path</span>
    <span class="n">outfilename</span> <span class="o">=</span> <span class="n">source</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_concatenated.fasta&quot;</span>

    <span class="c1"># Flag to track if any file was processed (not the most elegant way, but here we are)</span>
    <span class="n">files_written</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Open the output file in binary mode, write the contents of all other files to concat file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfilename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">outfilename</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>  <span class="c1"># Skip the output file</span>
                    <span class="k">continue</span>
                <span class="k">with</span> <span class="n">filename</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readfile</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">readfile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
                    <span class="n">files_written</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not open or read files in </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">. Concatenation failed.&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not open or read files in </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">. Concatenation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># Raise an exception if no files were processed</span>
    <span class="k">if</span> <span class="n">files_written</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not open or read files in </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">. Concatenation failed.&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files found to concatenate in folder: </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outfilename</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.delete_concats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_concats</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">neighbour</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete concatenated fasta files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the concatenated targets</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbour</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the concatenated neighbours</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_concats</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">neighbour</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete concatenated fasta files.</span>

<span class="sd">    Args:</span>
<span class="sd">        target (Path): the concatenated targets</span>
<span class="sd">        neighbour (Path): the concatenated neighbours</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">neighbour</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Concatenated files deleted.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting concatenated files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.extract_primer_sequences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_primer_sequences</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract primer sequences from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a path object of the file containing primers (generated by Primer3 module)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[str, str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a tuple of the primers and the internal probe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_primer_sequences</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract primer sequences from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): a path object of the file containing primers (generated by Primer3 module)</span>

<span class="sd">    Returns:</span>
<span class="sd">        a tuple of the primers and the internal probe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initialize empty dictionary</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PRIMER_LEFT&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;PRIMER_RIGHT&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;PRIMER_INTERNAL&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># if you find a line with the keys from sequences, then add the next line as a value to the key in this dictionary</span>
    <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sequences</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">sequences</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># did not find all keys (not all values in dictionary are truthy)? Throw error!</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">sequences</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;The primer headers are not correctly formatted and cannot be processed. Please change the headers accordingly.&quot;</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">sequences</span><span class="p">[</span><span class="s2">&quot;PRIMER_LEFT&quot;</span><span class="p">],</span>
        <span class="n">sequences</span><span class="p">[</span><span class="s2">&quot;PRIMER_RIGHT&quot;</span><span class="p">],</span>
        <span class="n">sequences</span><span class="p">[</span><span class="s2">&quot;PRIMER_INTERNAL&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.get_amplicon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_amplicon</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract the amplicon from the sequence file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the bed-file with the amplicon in column 7</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amplicon as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_amplicon</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the amplicon from the sequence file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): the bed-file with the amplicon in column 7</span>

<span class="sd">    Returns:</span>
<span class="sd">        The amplicon as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># open file, split first line by tab delimiter, return the amplicon in column 7</span>
    <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">amplicon</span> <span class="o">=</span> <span class="n">first_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">amplicon</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.get_longest_target" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_longest_target</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Within the target folder find the longest fasta</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>within the directory with the target assemblies, find the longest assembly.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of the path to the file with the longest assembly</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_longest_target</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Within the target folder find the longest fasta</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (Path): within the directory with the target assemblies, find the longest assembly.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The string representation of the path to the file with the longest assembly</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">longest_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">longest_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># don&#39;t read in anything but fasta files</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fasta&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fa&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.fna&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="c1"># Read sequences in the file</span>
            <span class="n">sequences</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>

            <span class="c1"># total length of all contigs together</span>
            <span class="n">total_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">)</span>

            <span class="c1"># if longer than previous longest assembly, replace with current assembly</span>
            <span class="k">if</span> <span class="n">total_length</span> <span class="o">&gt;</span> <span class="n">longest_length</span><span class="p">:</span>
                <span class="n">longest_length</span> <span class="o">=</span> <span class="n">total_length</span>
                <span class="n">longest_file</span> <span class="o">=</span> <span class="n">filepath</span>

    <span class="c1"># make sure that this function returns something or fails gracefully    </span>
    <span class="k">if</span> <span class="n">longest_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No valid FASTA files found in the directory.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">longest_file</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.move_files_with_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">move_files_with_pattern</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Move files containing a specific pattern from source to destination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path object of folder containing files to be moved</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the pattern that needs to be in the file name for the file to be shifted into the destination folder</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destination_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path object of the folder the files with a matching pattern in the file are moved to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">move_files_with_pattern</span><span class="p">(</span><span class="n">source_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move files containing a specific pattern from source to destination.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_dir (Path): path object of folder containing files to be moved</span>
<span class="sd">        pattern (str): the pattern that needs to be in the file name for the file to be shifted into the destination folder</span>
<span class="sd">        destination_dir (Path): path object of the folder the files with a matching pattern in the file are moved to</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create destination folder unless it already exists, do not raise FileExistsError</span>
    <span class="n">destination_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># iterate through the directory, move files that have a certain pattern in their name</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">source_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">destination_file</span> <span class="o">=</span> <span class="n">destination_dir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination_file</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.run_seqkit_amplicon_with_optional_timeout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_seqkit_amplicon_with_optional_timeout</span><span class="p">(</span><span class="n">frwd</span><span class="p">,</span> <span class="n">rev</span><span class="p">,</span> <span class="n">concat</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Run seqkit amplicon with an optional timeout and return the output.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>frwd</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The forward primer sequence.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rev</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The reverse primer sequence.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>concat</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the concatenated file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of allowed mismatches.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>Optional[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeout in seconds for the subprocess. If None, no timeout is applied.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Output of seqkit amplicon as a string if successful, None if it times out.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If invalid arguments are provided.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="subprocess.CalledProcessError">CalledProcessError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If seqkit amplicon fails with a non-zero exit code.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_seqkit_amplicon_with_optional_timeout</span><span class="p">(</span>
    <span class="n">frwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rev</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">concat</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run seqkit amplicon with an optional timeout and return the output.</span>

<span class="sd">    Args:</span>
<span class="sd">        frwd (str): The forward primer sequence.</span>
<span class="sd">        rev (str): The reverse primer sequence.</span>
<span class="sd">        concat (str): Path to the concatenated file.</span>
<span class="sd">        number (int): The number of allowed mismatches.</span>
<span class="sd">        timeout (Optional[int]): Timeout in seconds for the subprocess. If None, no timeout is applied.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Output of seqkit amplicon as a string if successful, None if it times out.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If invalid arguments are provided.</span>
<span class="sd">        subprocess.CalledProcessError: If seqkit amplicon fails with a non-zero exit code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate inputs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">frwd</span><span class="p">,</span> <span class="n">rev</span><span class="p">,</span> <span class="n">concat</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Forward primer, reverse primer, and concatenated file must be provided.&quot;</span>
        <span class="p">)</span>
    <span class="c1"># sense check mismatch number </span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Error in function call of run_seqkit_amplicon_with_optional_timeout. Mismatch number must be a non-negative integer.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mismatch number must be a non-negative integer.&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Running seqkit amplicon on </span><span class="si">{</span><span class="n">concat</span><span class="si">}</span><span class="s2"> with primers </span><span class="si">{</span><span class="n">frwd</span><span class="si">}</span><span class="s2"> (forward) and </span><span class="si">{</span><span class="n">rev</span><span class="si">}</span><span class="s2"> (reverse).&quot;</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Step 1: Create subprocess to read the input file using &#39;cat&#39;</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">concat</span><span class="p">],</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>  <span class="c1"># Send output to the next process</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Enable text mode for I/O</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;cat </span><span class="si">{</span><span class="n">concat</span><span class="si">}</span><span class="s2">&#39; subprocess started successfully.&quot;</span><span class="p">)</span>

        <span class="c1"># Step 2: Pipe the output of &#39;cat&#39; into &#39;seqkit amplicon&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;&#39;seqkit amplicon&#39; subprocess started successfully.&quot;</span><span class="p">)</span>
        <span class="n">seqkit_out</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;seqkit&quot;</span><span class="p">,</span> <span class="s2">&quot;amplicon&quot;</span><span class="p">,</span> <span class="s2">&quot;-F&quot;</span><span class="p">,</span> <span class="n">frwd</span><span class="p">,</span> <span class="s2">&quot;-R&quot;</span><span class="p">,</span> <span class="n">rev</span><span class="p">,</span> <span class="s2">&quot;--bed&quot;</span><span class="p">,</span> <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)],</span>
            <span class="n">stdin</span><span class="o">=</span><span class="n">cat</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>  <span class="c1"># Input from &#39;cat&#39; command</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>  <span class="c1"># Capture standard output</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>  <span class="c1"># Capture standard error</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Enable text mode for I/O</span>
        <span class="p">)</span>

        <span class="c1"># Step 3: Handle timeout if provided</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">seqkit_out</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">seqkit_out</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="c1"># Step 4: Check for errors</span>
        <span class="k">if</span> <span class="n">seqkit_out</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seqkit error output: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
                <span class="n">seqkit_out</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s2">&quot;seqkit amplicon&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Seqkit amplicon ran successfully. Output size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="si">}</span><span class="s2"> characters.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
        <span class="c1"># Handle timeout scenarios</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seqkit amplicon timed out after </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
        <span class="n">seqkit_out</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Ensure seqkit process is terminated</span>
        <span class="k">if</span> <span class="n">cat</span><span class="p">:</span>
            <span class="n">cat</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Ensure &#39;cat&#39; process is terminated</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle non-zero exit codes from seqkit</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Seqkit amplicon failed with exit code </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
            <span class="n">returncode</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;seqkit amplicon&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle any unexpected exceptions</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Cleanup: Ensure all subprocesses are terminated</span>
        <span class="k">if</span> <span class="n">cat</span> <span class="ow">and</span> <span class="n">cat</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cat</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">seqkit_out</span> <span class="ow">and</span> <span class="n">seqkit_out</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seqkit_out</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Primer_Testing_module_optimized.run_seqkit_locate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_seqkit_locate</span><span class="p">(</span><span class="n">amplicon</span><span class="p">,</span> <span class="n">ref_file</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs seqkit locate on a reference or an assembly with the amplicon, finds its coordinates and returns them in a bed file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>amplicon</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the amplicon</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ref_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path object of file used as reference</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>seqkit locate output in bed format</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Primer_Testing_module_optimized.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_seqkit_locate</span><span class="p">(</span><span class="n">amplicon</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span><span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs seqkit locate on a reference or an assembly with the amplicon, finds its coordinates and returns them in a bed file</span>

<span class="sd">    Args:</span>
<span class="sd">        amplicon (str): the amplicon</span>
<span class="sd">        ref_file (Path): path object of file used as reference</span>

<span class="sd">    Returns:</span>
<span class="sd">        seqkit locate output in bed format</span>

<span class="sd">    Raises:</span>
<span class="sd">        subprocess.CalledProcessError</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running seqkit locate on the following assembly </span><span class="si">{</span><span class="n">ref_file</span><span class="si">}</span><span class="s2"> with the amplicon.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Create subprocess to read the input file using &#39;cat&#39;</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">ref_file</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Pipe that output into subprocess that runs seqkit locate</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;started subprocess seqkit locate&quot;</span><span class="p">)</span>
        <span class="n">seqkit_out</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;seqkit&quot;</span><span class="p">,</span> <span class="s2">&quot;locate&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="n">amplicon</span><span class="p">,</span> <span class="s2">&quot;--bed&quot;</span><span class="p">,</span> <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span>
            <span class="n">stdin</span><span class="o">=</span><span class="n">cat</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># get both the output and potential errors</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">seqkit_out</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

        <span class="c1"># check for errors THIS IS REDUNDANT, REMOVE IN NEXT ITERATION OF IMPROVAL</span>
        <span class="k">if</span> <span class="n">seqkit_out</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error output from seqkit: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span><span class="n">seqkit_out</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="s2">&quot;seqkit locate&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;seqkit locate ran successfully, returning the output...&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>
    <span class="c1"># if subprocess failed and exception was not handled elsewhere</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;seqkit locate failed with errorcode </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
            <span class="n">returncode</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;seqkit locate&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="key-functions-of-summarize_results_module_improved">Key Functions of Summarize_results_module_improved</h2>


<div class="doc doc-object doc-module">



<a id="scripts.Summarize_results_module_improved"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.check_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_folders</span><span class="p">(</span><span class="o">*</span><span class="n">folders</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if folders exist and are non-empty. Forces sys.exit if either is not true.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folders</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one or multiple path objects of folders</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_folders</span><span class="p">(</span><span class="o">*</span><span class="n">folders</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if folders exist and are non-empty. Forces sys.exit if either is not true.</span>

<span class="sd">    Args:</span>
<span class="sd">        folders (Path): one or multiple path objects of folders</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; Error in check_folders function: the folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> does not exist&quot;</span>
            <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in check_folders function: the folder </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> is empty&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.count_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_files</span><span class="p">(</span><span class="n">folda</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Counts the number of files in a folder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folda</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a Path object that is the folder you want to count the files in</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of files as an integer</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">count_files</span><span class="p">(</span><span class="n">folda</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Counts the number of files in a folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        folda (Path): a Path object that is the folder you want to count the files in</span>

<span class="sd">    Returns:</span>
<span class="sd">        the number of files as an integer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># kind of an elegant way to count files in folders</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">folda</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.extract_number_and_primers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_number_and_primers</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract the primer number, primer sequences, and amplicon length from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the filepath of the primerset in question (to get the number; generated by Primer3 module)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the path object with the in silico testing results files</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, str, str, str, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a tuple with the identification number of the primer, the primers and the amplicon length</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_number_and_primers</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the primer number, primer sequences, and amplicon length from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (Path): the filepath of the primerset in question (to get the number; generated by Primer3 module)</span>
<span class="sd">        folder (Path): the path object with the in silico testing results files</span>

<span class="sd">    Returns:</span>
<span class="sd">        a tuple with the identification number of the primer, the primers and the amplicon length</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the number is our identifier for the primer</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">extract_number_from_filename</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># extract primer sequence</span>
    <span class="n">pr_frwd</span><span class="p">,</span> <span class="n">pr_rev</span><span class="p">,</span> <span class="n">pr_intern</span> <span class="o">=</span> <span class="n">extract_primer_sequences</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># get the amplicon length from the amplified sequences in the in silico files</span>
    <span class="n">target_seq</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Primer_</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">.txt_seqkit_amplicon_against_target_m0.txt&quot;</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">target_seq</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;No file with in silico results for the target at m0 found.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No file matches the pattern </span><span class="si">{</span><span class="n">target_seq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ampli_len</span> <span class="o">=</span> <span class="n">get_amplicon_length_from_seq</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">number</span><span class="p">,</span> <span class="n">pr_frwd</span><span class="p">,</span> <span class="n">pr_rev</span><span class="p">,</span> <span class="n">pr_intern</span><span class="p">,</span> <span class="n">ampli_len</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.extract_number_from_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_number_from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract the primer number from the file name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the file's name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an integer that is the identifier of the primer and all its associated results</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_number_from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the primer number from the file name.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): the file&#39;s name</span>

<span class="sd">    Returns:</span>
<span class="sd">        an integer that is the identifier of the primer and all its associated results</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># regex match the number</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(\d+)\.txt&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="c1"># if match is found, return the number</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No number found in the filename: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No number found in the filename: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.extract_primer_sequences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_primer_sequences</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract primer sequences from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a path object of the file containing primers (generated by Primer3 module)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[str, str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a tuple of the primers and the internal probe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_primer_sequences</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract primer sequences from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): a path object of the file containing primers (generated by Primer3 module)</span>

<span class="sd">    Returns:</span>
<span class="sd">        a tuple of the primers and the internal probe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initialize empty dictionary</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PRIMER_LEFT&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;PRIMER_RIGHT&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;PRIMER_INTERNAL&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># if you find a line with the keys from sequences, then add the next line as a value to the key in this dictionary</span>
    <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sequences</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">sequences</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># did not find all keys (not all values in dictionary are truthy)? Throw error!</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">sequences</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;The primer headers are not correctly formatted and cannot be processed. Please change the headers accordingly.&quot;</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">sequences</span><span class="p">[</span><span class="s2">&quot;PRIMER_LEFT&quot;</span><span class="p">],</span>
        <span class="n">sequences</span><span class="p">[</span><span class="s2">&quot;PRIMER_RIGHT&quot;</span><span class="p">],</span>
        <span class="n">sequences</span><span class="p">[</span><span class="s2">&quot;PRIMER_INTERNAL&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.generate_html_jinja" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_html_jinja</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">primer_frwd</span><span class="p">,</span> <span class="n">primer_rev</span><span class="p">,</span> <span class="n">primer_internal</span><span class="p">,</span> <span class="n">sensi_pass</span><span class="p">,</span> <span class="n">sensi_ass_no</span><span class="p">,</span> <span class="n">sensi_m</span><span class="p">,</span> <span class="n">speci_pass</span><span class="p">,</span> <span class="n">speci_ass_no</span><span class="p">,</span> <span class="n">speci_m</span><span class="p">,</span> <span class="n">sensi</span><span class="p">,</span> <span class="n">speci</span><span class="p">,</span> <span class="n">res_target_str</span><span class="p">,</span> <span class="n">primer_fold</span><span class="p">,</span> <span class="n">target_fold</span><span class="p">,</span> <span class="n">seqkit_fold</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">qPCR</span><span class="p">,</span> <span class="n">ampli_len</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate HTML content for the results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>header</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the header with type of primer and file name of primer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_frwd</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the forward primer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_rev</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the reverse primer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_internal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the internal probe (qPCR only, otherwise set to NA)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sensi_pass</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>did it pass the sensitivity tests? (either "passed" or "failed")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci_pass</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>did it pass the specificity tests? (either "passed" or "failed")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci_ass_no</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of assemblies tested for specificity</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci_m</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of mismatches allowed in the test for seqkit</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sensi</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary with all sensitivity testing results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary with all the specificity testing results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>res_target_str</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>results of the blastx testing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the path object of the folder the primers are in</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Path object of the folder the targets are in</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seqkit_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Path object of the folder with the in silico testing results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Path object of the folder the entire thing is in (parent folder of all DiPPER2 results)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qPCR</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>toggle of y or n to change formatting according to whether it is qPCR or not</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_html_jinja</span><span class="p">(</span>
    <span class="n">header</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_frwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_rev</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_internal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sensi_pass</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sensi_ass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">sensi_m</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">speci_pass</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">speci_ass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">speci_m</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sensi</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">speci</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">res_target_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_fold</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">target_fold</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">seqkit_fold</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">source_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">qPCR</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ampli_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate HTML content for the results.</span>

<span class="sd">    Args:</span>
<span class="sd">        All args are generated by the generate_results function</span>
<span class="sd">        header (str): the header with type of primer and file name of primer</span>
<span class="sd">        primer_frwd (str): the forward primer</span>
<span class="sd">        primer_rev (str): the reverse primer</span>
<span class="sd">        primer_internal (str): the internal probe (qPCR only, otherwise set to NA)</span>
<span class="sd">        sensi_pass (str): did it pass the sensitivity tests? (either &quot;passed&quot; or &quot;failed&quot;)</span>
<span class="sd">        speci_pass (str): did it pass the specificity tests? (either &quot;passed&quot; or &quot;failed&quot;)</span>
<span class="sd">        speci_ass_no (int): number of assemblies tested for specificity</span>
<span class="sd">        speci_m (str): the number of mismatches allowed in the test for seqkit</span>
<span class="sd">        sensi (dict): the dictionary with all sensitivity testing results</span>
<span class="sd">        speci (dict): the dictionary with all the specificity testing results</span>
<span class="sd">        res_target_str (str): results of the blastx testing</span>
<span class="sd">        primer_fold (Path): the path object of the folder the primers are in</span>
<span class="sd">        target_fold (Path): the Path object of the folder the targets are in</span>
<span class="sd">        seqkit_fold (Path): the Path object of the folder with the in silico testing results</span>
<span class="sd">        source_fold (Path): the Path object of the folder the entire thing is in (parent folder of all DiPPER2 results)</span>
<span class="sd">        qPCR (str): toggle of y or n to change formatting according to whether it is qPCR or not</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># hardcoded output file name</span>
    <span class="n">HTML_OUTFILE</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;Results.html&quot;</span>

    <span class="c1"># return the directory of the script the function is called from, making sure that relative paths are converted to absolut paths</span>
    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

    <span class="c1"># create jinja2 environments, load templates</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
        <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script_dir</span><span class="p">,</span> <span class="s2">&quot;templates/&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">qPCR</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;results_qPCR.html&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;results.html&quot;</span><span class="p">)</span>

    <span class="c1"># render the html file with provided arguments</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
        <span class="n">primer_frwd</span><span class="o">=</span><span class="n">primer_frwd</span><span class="p">,</span>
        <span class="n">primer_rev</span><span class="o">=</span><span class="n">primer_rev</span><span class="p">,</span>
        <span class="n">primer_internal</span><span class="o">=</span><span class="n">primer_internal</span><span class="p">,</span>
        <span class="n">ampli_length</span><span class="o">=</span><span class="n">ampli_len</span><span class="p">,</span>
        <span class="n">sensi</span><span class="o">=</span><span class="n">pformat</span><span class="p">(</span><span class="n">sensi</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">speci</span><span class="o">=</span><span class="n">pformat</span><span class="p">(</span><span class="n">speci</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">res_target_str</span><span class="o">=</span><span class="n">res_target_str</span><span class="p">,</span>
        <span class="n">primer_fold</span><span class="o">=</span><span class="n">primer_fold</span><span class="p">,</span>
        <span class="n">target_fold</span><span class="o">=</span><span class="n">target_fold</span><span class="p">,</span>
        <span class="n">seqkit_fold</span><span class="o">=</span><span class="n">seqkit_fold</span><span class="p">,</span>
        <span class="n">sensi_pass</span><span class="o">=</span><span class="n">sensi_pass</span><span class="p">,</span>
        <span class="n">speci_pass</span><span class="o">=</span><span class="n">speci_pass</span><span class="p">,</span>
        <span class="n">sensi_ass_no</span><span class="o">=</span><span class="n">sensi_ass_no</span><span class="p">,</span>
        <span class="n">sensi_m</span><span class="o">=</span><span class="n">sensi_m</span><span class="p">,</span>
        <span class="n">speci_m</span><span class="o">=</span><span class="n">speci_m</span><span class="p">,</span>
        <span class="n">speci_ass_no</span><span class="o">=</span><span class="n">speci_ass_no</span><span class="p">,</span>
        <span class="n">source_folder</span><span class="o">=</span><span class="n">source_folder</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># appending</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">HTML_OUTFILE</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.generate_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_results</span><span class="p">(</span><span class="n">destination_folder_primer</span><span class="p">,</span> <span class="n">destination_folder_tar</span><span class="p">,</span> <span class="n">destination_seqkit</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">count_target</span><span class="p">,</span> <span class="n">count_neighbour</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">qPCR</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Gets the primers &amp; amplicon length, processes them for output, gets the results from the sensitivity and specificity tests
and finally also gets the blast results. It then calls the print results function to generate an output file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>destination_folder_primer</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the folder that stores primers and primer data, as well as in silico tests</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destination_folder_target</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the folder that stores the target fastas and the blastx results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destination_folder_seqkit</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>subfolder of the primer folder where the in silico results are stored</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a primer fasta file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count_target</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of targets</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count_neighbour</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of neighbours</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one folder to rule them all (the folder with all DiPPER results of this run)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qPCR</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a toggle whether qPCR primers are wanted and have been generated or not</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_results</span><span class="p">(</span>
    <span class="n">destination_folder_primer</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">destination_folder_tar</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">destination_seqkit</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">count_target</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">count_neighbour</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">source_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">qPCR</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the primers &amp; amplicon length, processes them for output, gets the results from the sensitivity and specificity tests</span>
<span class="sd">    and finally also gets the blast results. It then calls the print results function to generate an output file.</span>

<span class="sd">    Args:</span>
<span class="sd">        destination_folder_primer (Path): the folder that stores primers and primer data, as well as in silico tests</span>
<span class="sd">        destination_folder_target (Path): the folder that stores the target fastas and the blastx results</span>
<span class="sd">        destination_folder_seqkit (Path): subfolder of the primer folder where the in silico results are stored</span>
<span class="sd">        file_path (Path): a primer fasta file</span>
<span class="sd">        count_target (int): the number of targets</span>
<span class="sd">        count_neighbour (int): the number of neighbours</span>
<span class="sd">        source_folder (Path): one folder to rule them all (the folder with all DiPPER results of this run)</span>
<span class="sd">        qPCR (str): a toggle whether qPCR primers are wanted and have been generated or not</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrieving Primers and obtaining amplicon length...&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">number</span><span class="p">,</span> <span class="n">pr_frwd</span><span class="p">,</span> <span class="n">pr_rev</span><span class="p">,</span> <span class="n">pr_intern</span><span class="p">,</span> <span class="n">ampli_len</span> <span class="o">=</span> <span class="n">extract_number_and_primers</span><span class="p">(</span>
            <span class="n">file_path</span><span class="p">,</span> <span class="n">destination_seqkit</span><span class="p">,</span> <span class="n">logger</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">if</span> <span class="n">qPCR</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;RESULTS FOR qPCR PRIMER </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;RESULTS FOR CONV. PCR PRIMER </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">primer_frwd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&gt;Forward Primer </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">pr_frwd</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">primer_rev</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&gt;Reverse Primer </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">pr_rev</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">primer_internal</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&gt;Internal Probe </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">pr_intern</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Assessing the in silico PCR results and determining Specificity and Sensitivity...&quot;</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sensi</span> <span class="o">=</span> <span class="n">run_tests</span><span class="p">(</span>
            <span class="n">destination_seqkit</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">ampli_len</span><span class="p">,</span>
            <span class="n">count_target</span><span class="p">,</span>
            <span class="s2">&quot;target&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sensitivity tests failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sensitivity tests failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">speci</span> <span class="o">=</span> <span class="n">run_tests</span><span class="p">(</span>
            <span class="n">destination_seqkit</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">ampli_len</span><span class="p">,</span>
            <span class="n">count_neighbour</span><span class="p">,</span>
            <span class="s2">&quot;neighbour&quot;</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specificity tests failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specificity tests failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Retrieving the blastx results of the targets, if entrez direct (eutils) is installed, also check NCBI annotation...&quot;</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res_target_str</span> <span class="o">=</span> <span class="n">handle_blasts_and_efetch</span><span class="p">(</span>
            <span class="n">destination_folder_tar</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">logger</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BLASTX Target Testing failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BLASTX Target Testing failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="n">results_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="c1"># interpret the tests</span>
    <span class="c1"># Sensi</span>
    <span class="n">sensi_pass</span><span class="p">,</span> <span class="n">sensi_ass_no</span><span class="p">,</span> <span class="n">sensi_m</span> <span class="o">=</span> <span class="n">interpret_and_reformat_sensi_speci_tests</span><span class="p">(</span>
        <span class="n">sensi</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">logger</span>
    <span class="p">)</span>
    <span class="c1"># Speci</span>
    <span class="n">speci_pass</span><span class="p">,</span> <span class="n">speci_ass_no</span><span class="p">,</span> <span class="n">speci_m</span> <span class="o">=</span> <span class="n">interpret_and_reformat_sensi_speci_tests</span><span class="p">(</span>
        <span class="n">speci</span><span class="p">,</span> <span class="s2">&quot;neighbour&quot;</span><span class="p">,</span> <span class="n">logger</span>
    <span class="p">)</span>
    <span class="c1"># Print results to txt file and html</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Printing results to outfile. The results summary files &#39;Results.txt&#39; &amp; &#39;Results.html&#39; is found in </span><span class="si">{</span><span class="n">results_folder</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
    <span class="n">print_results</span><span class="p">(</span>
        <span class="n">header</span><span class="p">,</span>
        <span class="n">primer_frwd</span><span class="p">,</span>
        <span class="n">primer_rev</span><span class="p">,</span>
        <span class="n">primer_internal</span><span class="p">,</span>
        <span class="n">sensi_pass</span><span class="p">,</span>
        <span class="n">sensi_ass_no</span><span class="p">,</span>
        <span class="n">sensi_m</span><span class="p">,</span>
        <span class="n">speci_pass</span><span class="p">,</span>
        <span class="n">speci_ass_no</span><span class="p">,</span>
        <span class="n">speci_m</span><span class="p">,</span>
        <span class="n">sensi</span><span class="p">,</span>
        <span class="n">speci</span><span class="p">,</span>
        <span class="n">res_target_str</span><span class="p">,</span>
        <span class="n">destination_folder_primer</span><span class="p">,</span>
        <span class="n">destination_folder_tar</span><span class="p">,</span>
        <span class="n">destination_seqkit</span><span class="p">,</span>
        <span class="n">source_folder</span><span class="p">,</span>
        <span class="n">qPCR</span><span class="p">,</span>
        <span class="n">ampli_len</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.get_amplicon_length_from_seq" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_amplicon_length_from_seq</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract the amplicon length from the sequence file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a path object of the m0 mismatch target in silico test file (seqkit amplicon results for Sensitivity testing at m0)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the integer that is the amplicon length</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_amplicon_length_from_seq</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the amplicon length from the sequence file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): a path object of the m0 mismatch target in silico test file (seqkit amplicon results for Sensitivity testing at m0)</span>

<span class="sd">    Returns:</span>
<span class="sd">        the integer that is the amplicon length&quot;&quot;&quot;</span>
    <span class="c1"># open the file, read the first line, extract amplicon from the 7th column of the bed file</span>
    <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">amplicon</span> <span class="o">=</span> <span class="n">first_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplicon</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.get_highest_scoring_accession" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_highest_scoring_accession</span><span class="p">(</span><span class="n">blastx_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse a BLASTX output file to find the highest scoring accession and its evalue.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>blastx_file</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a path object of the blastx results file for the target in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[str, float, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a tuple of the Accession of the highest scoring entry, its evalue and its bitscore</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_highest_scoring_accession</span><span class="p">(</span><span class="n">blastx_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a BLASTX output file to find the highest scoring accession and its evalue.</span>

<span class="sd">    Args:</span>
<span class="sd">        blastx_file (Path): a path object of the blastx results file for the target in question.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a tuple of the Accession of the highest scoring entry, its evalue and its bitscore</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">blastx_file</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">blastx_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Blastx did not find hits. No file with the suffix </span><span class="si">{</span><span class="n">blastx_file</span><span class="si">}</span><span class="s2"> exists.&quot;</span>
        <span class="p">)</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;qseqid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sseqid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pident&quot;</span><span class="p">,</span>
        <span class="s2">&quot;length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mismatch&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gapopen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;qstart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;qend&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sstart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;send&quot;</span><span class="p">,</span>
        <span class="s2">&quot;evalue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bitscore&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">blastx_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The BLASTX file </span><span class="si">{</span><span class="n">blastx_file</span><span class="si">}</span><span class="s2"> is empty or does not contain expected data.&quot;</span>
            <span class="p">)</span>
        <span class="n">highest_scoring_row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bitscore&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">highest_scoring_row</span><span class="p">[</span><span class="s2">&quot;sseqid&quot;</span><span class="p">],</span>
            <span class="n">highest_scoring_row</span><span class="p">[</span><span class="s2">&quot;evalue&quot;</span><span class="p">],</span>
            <span class="n">highest_scoring_row</span><span class="p">[</span><span class="s2">&quot;bitscore&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Blast did not find hits&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.handle_blasts_and_efetch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">handle_blasts_and_efetch</span><span class="p">(</span><span class="n">destination_folder_tar</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Handle BLAST results and use efetch to get the highest scoring accession's title (description).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>destination_folder_tar</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the FUR.P3.TARGETS folder</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the identification number of the primer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a string with information on the highest scoring target</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">handle_blasts_and_efetch</span><span class="p">(</span>
    <span class="n">destination_folder_tar</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle BLAST results and use efetch to get the highest scoring accession&#39;s title (description).</span>

<span class="sd">    Args:</span>
<span class="sd">        destination_folder_tar (Path): the FUR.P3.TARGETS folder</span>
<span class="sd">        number (int): the identification number of the primer</span>

<span class="sd">    Returns:</span>
<span class="sd">        a string with information on the highest scoring target</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;running handle_blasts_and_efetch function to find highest scoring blast hits and determine what they are or run seqkit locate to generate bed files. &quot;</span>
    <span class="p">)</span>

    <span class="c1"># get the blast result</span>
    <span class="n">target_f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Target_</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">.txt_blastx_1e-5.txt&quot;</span>
    <span class="n">found_target</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">destination_folder_tar</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">target_f</span><span class="p">))</span>

    <span class="c1"># 1: get the file</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_target</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files for </span><span class="si">{</span><span class="n">target_f</span><span class="si">}</span><span class="s2"> were found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;No files for </span><span class="si">{</span><span class="n">target_f</span><span class="si">}</span><span class="s2"> found.&quot;</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">found_target</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;One or more files for </span><span class="si">{</span><span class="n">target_f</span><span class="si">}</span><span class="s2"> are empty. Blastx did not return result&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;One or more files for </span><span class="si">{</span><span class="n">target_f</span><span class="si">}</span><span class="s2"> are empty. Blastx did not return result&quot;</span>
        <span class="p">)</span>

    <span class="c1"># 2: get highest scoring accession</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">id</span><span class="p">,</span> <span class="n">evalue</span><span class="p">,</span> <span class="n">bitscore</span> <span class="o">=</span> <span class="n">get_highest_scoring_accession</span><span class="p">(</span><span class="n">found_target</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">evalue</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">evalue</span><span class="p">,</span> <span class="s2">&quot;.2e&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="s2">&quot;Blast did not find hits&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The primer </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&#39;s BLASTX search did not find any hits.</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># Error handling</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Value error while finding highest scoring accession: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Value error while finding highest scoring accession: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">ve</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">te</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Type error while finding highest scoring accession: </span><span class="si">{</span><span class="n">te</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Type error while finding highest scoring accession: </span><span class="si">{</span><span class="n">te</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">te</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">fnf</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found error: </span><span class="si">{</span><span class="n">fnf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found error: </span><span class="si">{</span><span class="n">fnf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">fnf</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown exception occured.Could not find highest scoring accession for blastx results: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not find highest scoring accession for blastx results: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># 3: make sure eutilities are in path</span>
    <span class="k">if</span> <span class="n">is_tool</span><span class="p">(</span><span class="s2">&quot;efetch&quot;</span><span class="p">):</span>

        <span class="c1"># if eutilities are in path, find the annotation of the accession</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">efetch_r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;efetch&quot;</span><span class="p">,</span> <span class="s2">&quot;-db&quot;</span><span class="p">,</span> <span class="s2">&quot;protein&quot;</span><span class="p">,</span> <span class="s2">&quot;-id&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;-format&quot;</span><span class="p">,</span> <span class="s2">&quot;docsum&quot;</span><span class="p">],</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">efetch_r</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;efetch command failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;efetch command failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xtract_r</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;xtract&quot;</span><span class="p">,</span> <span class="s2">&quot;-pattern&quot;</span><span class="p">,</span> <span class="s2">&quot;DocumentSummary&quot;</span><span class="p">,</span> <span class="s2">&quot;-element&quot;</span><span class="p">,</span> <span class="s2">&quot;Title&quot;</span><span class="p">],</span>
                <span class="n">stdin</span><span class="o">=</span><span class="n">efetch_r</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">xtract_r</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xtract command failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xtract command failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="n">title</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">xtract_r</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">accession</span> <span class="o">=</span> <span class="s2">&quot;https://www.ncbi.nlm.nih.gov/protein/&quot;</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The primer </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&#39;s target with the highest bitscore </span><span class="si">{</span><span class="n">bitscore</span><span class="si">}</span><span class="s2"> &amp; evalue </span><span class="si">{</span><span class="n">evalue</span><span class="si">}</span><span class="s2"> has the accession </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> and codes for </span><span class="si">{</span><span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span><span class="s2">Further information on the accession: </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">accession</span> <span class="o">=</span> <span class="s2">&quot;https://www.ncbi.nlm.nih.gov/protein/&quot;</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The primer </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&#39;s target with the highest bitscore </span><span class="si">{</span><span class="n">bitscore</span><span class="si">}</span><span class="s2"> &amp; evalue </span><span class="si">{</span><span class="n">evalue</span><span class="si">}</span><span class="s2"> has the accession </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span><span class="s2">Further information on the accession: </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.interpret_and_reformat_sensi_speci_tests" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpret_and_reformat_sensi_speci_tests</span><span class="p">(</span><span class="n">test_res</span><span class="p">,</span> <span class="n">flavour</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Interpret the Sensitivity and Specificity Tests, reformat the interpretation to a easy to grasp PASS or FAIL answer, make this     printable</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>test_res</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary of the test results for sensitivity or specificity testing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flavour</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target or neighbour</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[str, int, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a tuple with a pass or fail verdict (str), the number of processed assemblies (int) and the mismatches the test failed for (str; a concatenated string separated by colons)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpret_and_reformat_sensi_speci_tests</span><span class="p">(</span>
    <span class="n">test_res</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flavour</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpret the Sensitivity and Specificity Tests, reformat the interpretation to a easy to grasp PASS or FAIL answer, make this \</span>
<span class="sd">    printable</span>

<span class="sd">    Args:</span>
<span class="sd">        test_res (dict): a dictionary of the test results for sensitivity or specificity testing</span>
<span class="sd">        flavour (str): target or neighbour</span>

<span class="sd">    Returns:</span>
<span class="sd">        a tuple with a pass or fail verdict (str), the number of processed assemblies (int) and the mismatches the test failed for (str; a concatenated string separated by colons)  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">passed</span> <span class="o">=</span> <span class="s2">&quot;PASSED&quot;</span>
    <span class="n">ass_no</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fail_m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_dict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_res</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected a dictionary, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">test_res</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="c1"># set flag to see if nested dictionary is true</span>
    <span class="n">found_dict</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Filtering keys to only process those that map to dictionaries</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">test_res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">test_res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Skip keys that do not map to dictionaries</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="c1"># flag whether there is any dictionaries for result set to TRUE</span>
        <span class="n">found_dict</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">flavour</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Did the test pass?&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;passed&quot;</span><span class="p">:</span>
                <span class="n">ass_no</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">]</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Mismatches tested&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;m3&quot;</span>
            <span class="p">):</span>  <span class="c1"># if it is sensitivity testing, we tolerate that not all amplicons are the correct size for m3 or above</span>
                <span class="n">fail</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Mismatches tested&quot;</span><span class="p">]</span>
                <span class="n">fail_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail</span><span class="p">)</span>
                <span class="n">ass_no</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">]</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">passed</span> <span class="o">=</span> <span class="s2">&quot;FAILED&quot;</span>
                <span class="n">fail</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Mismatches tested&quot;</span><span class="p">]</span>
                <span class="n">fail_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail</span><span class="p">)</span>
                <span class="n">ass_no</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Did the test pass?&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;passed&quot;</span>
                <span class="ow">or</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Did the test pass?&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span>
            <span class="p">):</span>
                <span class="n">ass_no</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">]</span>
                <span class="n">fail</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Mismatches tested&quot;</span><span class="p">]</span>
                <span class="n">fail_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">passed</span> <span class="o">=</span> <span class="s2">&quot;FAILED&quot;</span>
                <span class="n">fail</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Mismatches tested&quot;</span><span class="p">]</span>
                <span class="n">fail_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail</span><span class="p">)</span>
                <span class="n">ass_no</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_dict</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No dicitionary was found in the iteration over test_res. This is not a dictionary but a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">found_dict</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;No dictionary was found in the iteration over test_res.&quot;</span><span class="p">)</span>

    <span class="n">fail_m</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fail_m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">passed</span><span class="p">,</span> <span class="n">ass_no</span><span class="p">,</span> <span class="n">fail_m</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.is_tool" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_tool</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check whether <code>name</code> is on PATH and marked as executable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the program</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True or False (boolean)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_tool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether `name` is on PATH and marked as executable.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): the name of the program</span>

<span class="sd">    Returns:</span>
<span class="sd">        True or False (boolean)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># which is a tool in shutil.</span>
    <span class="k">return</span> <span class="n">which</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>The main function. This is where the magic happens. Master of all puppets (functions). Also parses arguments, initializes logger, and calls all functions. Tadaa!</p>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main function. This is where the magic happens. Master of all puppets (functions). Also parses arguments, initializes logger, and calls all functions. Tadaa!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;DiPPER2 Summarize Results Module&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Summarize the results and generate html results&quot;</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;Theresa Wacker T.Wacker2@exeter.ac.uk&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(prog)s</span><span class="s2"> 0.1.0-beta&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--folder&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Results folder name, which includes results folders from previous steps&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--qPCR&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Toggles between qPCR (y) or no qPCR (n) results. Default is &#39;n&#39;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-V&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;increase logging verbosity&quot;</span>
    <span class="p">)</span>
    <span class="c1"># get args</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># one folder to rule them all</span>
    <span class="n">source_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>

    <span class="c1"># configures the logger</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
    <span class="n">logger_instance</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logger_instance</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to run the Summarize_results module. Logger is initialized.&quot;</span><span class="p">)</span>
    <span class="c1"># toggle qPCR</span>
    <span class="n">qPCR</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">qPCR</span>

    <span class="c1"># Define folders</span>
    <span class="n">destination_folder_pr</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.P3.PRIMERS&quot;</span>
    <span class="n">destination_folder_tar</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.P3.TARGETS&quot;</span>
    <span class="n">destination_folder_seqkit</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.P3.PRIMERS&quot;</span> <span class="o">/</span> <span class="s2">&quot;in_silico_tests&quot;</span>

    <span class="c1"># do they exist and are they not empty?</span>
    <span class="n">check_folders</span><span class="p">(</span>
        <span class="n">destination_folder_pr</span><span class="p">,</span> <span class="n">destination_folder_tar</span><span class="p">,</span> <span class="n">destination_folder_seqkit</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
    <span class="p">)</span>

    <span class="c1"># target and neighbour folders</span>
    <span class="n">fur_target</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.target&quot;</span>
    <span class="n">fur_neighbour</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;FUR.neighbour&quot;</span>

    <span class="c1"># do they exist and are they not empty?</span>
    <span class="n">check_folders</span><span class="p">(</span><span class="n">fur_target</span><span class="p">,</span> <span class="n">fur_neighbour</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="c1"># define how many targets (equivalent to number of target assemblies, each assembly in one file) and neighbours (ditto targets) there are</span>
    <span class="n">count_target</span> <span class="o">=</span> <span class="n">count_files</span><span class="p">(</span><span class="n">fur_target</span><span class="p">)</span>
    <span class="n">count_neighbour</span> <span class="o">=</span> <span class="n">count_files</span><span class="p">(</span><span class="n">fur_neighbour</span><span class="p">)</span>

    <span class="c1"># info</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has </span><span class="si">%d</span><span class="s2"> entries and </span><span class="si">%s</span><span class="s2"> has </span><span class="si">%d</span><span class="s2"> entries.&quot;</span><span class="p">,</span>
        <span class="n">fur_target</span><span class="p">,</span>
        <span class="n">count_target</span><span class="p">,</span>
        <span class="n">fur_neighbour</span><span class="p">,</span>
        <span class="n">count_neighbour</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># to be able to loop through each primer of the 4 candidates, find all the files and generate a list of paths (it is a generator object and yields Path objects with name and path attributes)</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">destination_folder_pr</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span>

    <span class="c1"># generate results</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">generate_results</span><span class="p">(</span>
                <span class="n">destination_folder_pr</span><span class="p">,</span>
                <span class="n">destination_folder_tar</span><span class="p">,</span>
                <span class="n">destination_folder_seqkit</span><span class="p">,</span>
                <span class="n">file_path</span><span class="p">,</span>
                <span class="n">count_target</span><span class="p">,</span>
                <span class="n">count_neighbour</span><span class="p">,</span>
                <span class="n">source_folder</span><span class="p">,</span>
                <span class="n">qPCR</span><span class="p">,</span>
                <span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.print_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_results</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">primer_frwd</span><span class="p">,</span> <span class="n">primer_rev</span><span class="p">,</span> <span class="n">primer_internal</span><span class="p">,</span> <span class="n">sensi_pass</span><span class="p">,</span> <span class="n">sensi_ass_no</span><span class="p">,</span> <span class="n">sensi_m</span><span class="p">,</span> <span class="n">speci_pass</span><span class="p">,</span> <span class="n">speci_ass_no</span><span class="p">,</span> <span class="n">speci_m</span><span class="p">,</span> <span class="n">sensi</span><span class="p">,</span> <span class="n">speci</span><span class="p">,</span> <span class="n">res_target_str</span><span class="p">,</span> <span class="n">primer_fold</span><span class="p">,</span> <span class="n">target_fold</span><span class="p">,</span> <span class="n">seqkit_fold</span><span class="p">,</span> <span class="n">source_folder</span><span class="p">,</span> <span class="n">qPCR</span><span class="p">,</span> <span class="n">ampli_len</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Does what it says on the tin:
Print results to a text file and a PDF (currently not implemented). Also generate an html.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>header</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the header with type of primer and file name of primer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_frwd</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the forward primer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_rev</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the reverse primer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_internal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the internal probe (qPCR only, otherwise set to NA)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sensi_pass</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>did it pass the sensitivity tests? (either "passed" or "failed")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci_pass</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>did it pass the specificity tests? (either "passed" or "failed")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci_ass_no</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of assemblies tested for specificity</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci_m</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of mismatches allowed in the test for seqkit</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sensi</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary with all sensitivity testing results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speci</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary with all the specificity testing results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>res_target_str</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>results of the blastx testing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>primer_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the path object of the folder the primers are in</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Path object of the folder the targets are in</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seqkit_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Path object of the folder with the in silico testing results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fold</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Path object of the folder the entire thing is in (parent folder of all DiPPER2 results)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qPCR</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>toggle of y or n to change formatting according to whether it is qPCR or not</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    None</p>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span>
    <span class="n">header</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_frwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_rev</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_internal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sensi_pass</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sensi_ass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">sensi_m</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">speci_pass</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">speci_ass_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">speci_m</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">sensi</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">speci</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">res_target_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">primer_fold</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">target_fold</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">seqkit_fold</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">source_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">qPCR</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ampli_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Does what it says on the tin:</span>
<span class="sd">    Print results to a text file and a PDF (currently not implemented). Also generate an html.</span>

<span class="sd">    Args:</span>
<span class="sd">        header (str): the header with type of primer and file name of primer</span>
<span class="sd">        primer_frwd (str): the forward primer</span>
<span class="sd">        primer_rev (str): the reverse primer</span>
<span class="sd">        primer_internal (str): the internal probe (qPCR only, otherwise set to NA)</span>
<span class="sd">        sensi_pass (str): did it pass the sensitivity tests? (either &quot;passed&quot; or &quot;failed&quot;)</span>
<span class="sd">        speci_pass (str): did it pass the specificity tests? (either &quot;passed&quot; or &quot;failed&quot;)</span>
<span class="sd">        speci_ass_no (int): number of assemblies tested for specificity</span>
<span class="sd">        speci_m (str): the number of mismatches allowed in the test for seqkit</span>
<span class="sd">        sensi (dict): the dictionary with all sensitivity testing results</span>
<span class="sd">        speci (dict): the dictionary with all the specificity testing results</span>
<span class="sd">        res_target_str (str): results of the blastx testing</span>
<span class="sd">        primer_fold (Path): the path object of the folder the primers are in</span>
<span class="sd">        target_fold (Path): the Path object of the folder the targets are in</span>
<span class="sd">        seqkit_fold (Path): the Path object of the folder with the in silico testing results</span>
<span class="sd">        source_fold (Path): the Path object of the folder the entire thing is in (parent folder of all DiPPER2 results)</span>
<span class="sd">        qPCR (str): toggle of y or n to change formatting according to whether it is qPCR or not</span>
<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># txt outfile</span>
    <span class="n">result_out</span> <span class="o">=</span> <span class="n">source_folder</span> <span class="o">/</span> <span class="s2">&quot;Results.txt&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing results to the results file Results.txt in </span><span class="si">{</span><span class="n">source_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">result_out</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">primer_frwd</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">primer_rev</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qPCR</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">primer_internal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Amplicon length: </span><span class="si">{</span><span class="n">ampli_len</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Sensitivity and Specificity testing:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Sensitivity:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pass or fail:</span><span class="se">\t</span><span class="si">{</span><span class="n">sensi_pass</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of assemblies the in silico PCR was run for:</span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">sensi_ass_no</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of mismatches the sensitivity test failed for (m3 is tolerated):</span><span class="se">\t</span><span class="si">{</span><span class="n">sensi_m</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Specificity:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pass or fail:</span><span class="se">\t</span><span class="si">{</span><span class="n">speci_pass</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of assemblies the in silico PCR was run for:</span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">speci_ass_no</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of mismatches the in silico PCR generated amplicons for:</span><span class="se">\t</span><span class="si">{</span><span class="n">speci_m</span><span class="si">}</span><span class="se">\n\</span>
<span class="s2">                   (Note that if the test has passed, this means the amplicons had an incorrect size)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;BLASTX Target Testing:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">res_target_str</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Files&amp;Folders:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Primers are found in </span><span class="si">{</span><span class="n">primer_fold</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target fastas and blastx results are found in </span><span class="si">{</span><span class="n">target_fold</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;If generated, bed files are present in </span><span class="si">{</span><span class="n">source_folder</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In silico PCR results are found in </span><span class="si">{</span><span class="n">seqkit_fold</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Detailed Sensitivity results:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># prettyprint allows to print a nested dictionary</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">sensi</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Detailed Specificity results:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">speci</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">################################################################################</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done!</span><span class="se">\n</span><span class="s2"> Generating html...&quot;</span><span class="p">)</span>
    <span class="n">generate_html_jinja</span><span class="p">(</span>
        <span class="n">header</span><span class="p">,</span>
        <span class="n">primer_frwd</span><span class="p">,</span>
        <span class="n">primer_rev</span><span class="p">,</span>
        <span class="n">primer_internal</span><span class="p">,</span>
        <span class="n">sensi_pass</span><span class="p">,</span>
        <span class="n">sensi_ass_no</span><span class="p">,</span>
        <span class="n">sensi_m</span><span class="p">,</span>
        <span class="n">speci_pass</span><span class="p">,</span>
        <span class="n">speci_ass_no</span><span class="p">,</span>
        <span class="n">speci_m</span><span class="p">,</span>
        <span class="n">sensi</span><span class="p">,</span>
        <span class="n">speci</span><span class="p">,</span>
        <span class="n">res_target_str</span><span class="p">,</span>
        <span class="n">primer_fold</span><span class="p">,</span>
        <span class="n">target_fold</span><span class="p">,</span>
        <span class="n">seqkit_fold</span><span class="p">,</span>
        <span class="n">source_folder</span><span class="p">,</span>
        <span class="n">qPCR</span><span class="p">,</span>
        <span class="n">ampli_len</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.Summarize_results_module_improved.run_tests" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_tests</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">target_type</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse the Specificity and Sensitivity test results based on the in silico PCRs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a path object corresponding to the folder with the in silico results (in the FUR.P3.PRIMERS) folder</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the primer file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>length</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the length of the amplicon</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of targets or neighbours</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"target" or "neighbour"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary with the results for targets and neighbours (specificity and sensitivity). Raw numbers not interpreted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>scripts/Summarize_results_module_improved.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_tests</span><span class="p">(</span>
    <span class="n">folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the Specificity and Sensitivity test results based on the in silico PCRs.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder (Path): a path object corresponding to the folder with the in silico results (in the FUR.P3.PRIMERS) folder</span>
<span class="sd">        file (str): the primer file</span>
<span class="sd">        length (int): the length of the amplicon</span>
<span class="sd">        count (int): the number of targets or neighbours</span>
<span class="sd">        target_type (str): &quot;target&quot; or &quot;neighbour&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        a dictionary with the results for targets and neighbours (specificity and sensitivity). Raw numbers not interpreted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Starting the run_tests function and parsing the information of the in silico tests.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># find the in silico testing files</span>
    <span class="n">file_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">_seqkit_amplicon_against_</span><span class="si">{</span><span class="n">target_type</span><span class="si">}</span><span class="s2">_m*&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
    <span class="c1"># initialize counters</span>
    <span class="n">amp_f_overall</span><span class="p">,</span> <span class="n">passed</span><span class="p">,</span> <span class="n">failed</span><span class="p">,</span> <span class="n">passed_n</span><span class="p">,</span> <span class="n">failed_n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># default if for instance Specificity tests do not amplify anything in silico (= no files)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No files with </span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2"> found. Setting dictionary entries to NA.&quot;</span>
        <span class="p">)</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Mismatches tested&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Did the test pass?&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Number of assemblies with correct size amplicon&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Number of assemblies with wrong size amplicon&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;Number of files that passed:&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;Number of files that failed:&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
        <span class="k">return</span> <span class="n">results_dict</span>
    <span class="c1"># how many files are there</span>
    <span class="n">no_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="c1"># for each file initialize</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># find out the number of mismatches based on file name</span>
            <span class="n">mismatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(m\d)\.txt&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mismatch</span><span class="p">:</span>
                <span class="n">m_no</span> <span class="o">=</span> <span class="n">mismatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># print(f&quot;Found match: {m_no}&quot;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not determine value of mismatches&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No match found in the document name.&quot;</span><span class="p">)</span>

        <span class="c1"># except Exception as e:</span>
        <span class="c1">#     raise</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Value error when trying to find matching document name: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Value error when trying to find matching document name: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">ve</span>
        <span class="n">passed_amp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">failed_amp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="c1"># have all assemblies yielded one amplicon?</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
                    <span class="c1"># Process each line to count correct and incorrect amplicon lengths</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="n">amp_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">amp_len</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
                            <span class="n">passed_amp</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">failed_amp</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">amp_f_overall</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># Check if all assemblies have correct-length amplicons</span>
                    <span class="k">if</span> <span class="n">passed_amp</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
                        <span class="n">passed</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">failed_n</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># For specificity, correct counts in neighbor tests are a failure</span>
                    <span class="k">if</span> <span class="n">failed_amp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">failed</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># for sensitivity, this is a failure</span>
                        <span class="n">passed_n</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># for specificity, thisnis what we want</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If count mismatches, adjust pass/fail logic accordingly</span>
                    <span class="n">failed</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">passed_n</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;neighbour&quot;</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="n">amp_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">6</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">amp_len</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
                            <span class="n">passed_amp</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">failed_amp</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">amp_f_overall</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;neighbour&quot;</span> <span class="ow">and</span> <span class="n">passed_amp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">passed_n</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="n">failed_n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to open or read file </span><span class="si">{</span><span class="n">doc</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Unable to open file&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="c1"># Define whether it is Specificity or Sensitivity test and fail or pass test accordingly</span>
        <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span>
            <span class="c1"># only passed if all targets have been amplified to the correct length</span>
            <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot;passed&quot;</span> <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">passed_amp</span> <span class="k">else</span> <span class="s2">&quot;failed&quot;</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Mismatches tested&quot;</span><span class="p">:</span> <span class="n">m_no</span><span class="p">,</span>
                <span class="s2">&quot;Did the test pass?&quot;</span><span class="p">:</span> <span class="n">note</span><span class="p">,</span>
                <span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;Number of assemblies with correct size amplicon&quot;</span><span class="p">:</span> <span class="n">passed_amp</span><span class="p">,</span>
                <span class="s2">&quot;Number of assemblies with wrong size amplicon&quot;</span><span class="p">:</span> <span class="n">failed_amp</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># only pass if no neighbours have been amplified with the correct size amplicon.</span>
            <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot;passed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">passed</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">passed_amp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;failed&quot;</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Mismatches tested&quot;</span><span class="p">:</span> <span class="n">m_no</span><span class="p">,</span>
                <span class="s2">&quot;Did the test pass?&quot;</span><span class="p">:</span> <span class="n">note</span><span class="p">,</span>
                <span class="s2">&quot;Number of assemblies, in silico PCR was performed on&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s2">&quot;Number of assemblies with correct size amplicon&quot;</span><span class="p">:</span> <span class="n">passed_amp</span><span class="p">,</span>
            <span class="p">}</span>
    <span class="n">results_dict</span><span class="p">[</span>
        <span class="s2">&quot;Number of files (in silico PCR result files for different number of primer mismatches) tested:&quot;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">no_files</span>
    <span class="k">if</span> <span class="n">target_type</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;Number of files that passed:&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">passed</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;Number of files that failed:&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">failed</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;Number of files that passed:&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">passed_n</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;Number of files that failed:&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">failed_n</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;End of run_tests function. Returning dictionary.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="key-functions-of-fur2primer3">Key Functions of fur2primer3</h2>


<div class="doc doc-object doc-module">



<a id="scripts.fur2primer3"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="scripts.fur2primer3.args_to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">args_to_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>The parameter string is split by whitespace and parameters are used as keys and the parametervalues as values for a dictionary. For example primMaxTm=62 would be the key-value pair primMaxTm: 62 in the dictionary.</p>

            <details class="quote">
              <summary>Source code in <code>scripts/fur2primer3.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">args_to_dict</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;The parameter string is split by whitespace and parameters are used as keys and the parametervalues as values for a dictionary. For example primMaxTm=62 would be the key-value pair primMaxTm: 62 in the dictionary.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.fur2primer3.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Run the functions. Takes a fasta and converts it into a Primer3-compatible input file. Do what main does (aka parse arguments, run everything).</p>

            <details class="quote">
              <summary>Source code in <code>scripts/fur2primer3.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Run the functions. Takes a fasta and converts it into a Primer3-compatible input file. Do what main does (aka parse arguments, run everything).&#39;&#39;&#39;</span>
    <span class="c1">#parse the args</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s2">&quot;DiPPER2&quot;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Converting Fastas (including FUR output) to Primer3-compatible output format&#39;</span><span class="p">,</span> <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;t.wacker2@exeter.ac.uk&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(prog)s</span><span class="s2"> 0.1.0-beta&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--parameters&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;primMinTm=58 primOptTm=60 primMaxTm=62 inMinTm=63 inOptTm=65 inMaxTm=67 prodMinSize=100 prodMaxSize=200&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Primer3 primer parameters. Default: primMinTm=58 primOptTm=60 primMaxTm=62 inMinTm=63 inOptTm=65 inMaxTm=67 prodMinSize=100 prodMaxSize=200. Internal Probe is also picked by default.&quot;</span> <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--input_file&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The fasta file to be converted. Can be the FUR output file.&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># parse parameters (dictionary)</span>
    <span class="n">params</span><span class="o">=</span><span class="n">args_to_dict</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="c1">#remap/ convert parameter keys to Primer3 conventions</span>
    <span class="n">form_param</span><span class="o">=</span><span class="n">remap_keys</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1">#write Primer3 compatible file.</span>
    <span class="n">write_result</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input_file</span><span class="p">,</span><span class="n">form_param</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.fur2primer3.remap_keys" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remap_keys</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Rename the keys of the dictionary to Primer3 conventions and set defaults.</p>

            <details class="quote">
              <summary>Source code in <code>scripts/fur2primer3.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remap_keys</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Rename the keys of the dictionary to Primer3 conventions and set defaults.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;PRIMER_TASK&quot;</span><span class="p">:</span> <span class="s2">&quot;generic&quot;</span><span class="p">,</span>
		<span class="s2">&quot;PRIMER_PICK_LEFT_PRIMER&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
		<span class="s2">&quot;PRIMER_PICK_RIGHT_PRIMER&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
		<span class="s2">&quot;PRIMER_PICK_INTERNAL_OLIGO&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Oligo&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_MIN_SIZE&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;primMinSize&quot;</span><span class="p">,</span> <span class="s2">&quot;15&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_MAX_SIZE&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;primMaxSize&quot;</span><span class="p">,</span><span class="s2">&quot;25&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_PRODUCT_SIZE_RANGE&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prodMinSize&quot;</span><span class="p">,</span><span class="s2">&quot;100&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prodMaxSize&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;200&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
		<span class="s2">&quot;PRIMER_MIN_TM&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;primMinTm&quot;</span><span class="p">,</span> <span class="s2">&quot;58&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_OPT_TM&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;primOptTm&quot;</span><span class="p">,</span> <span class="s2">&quot;60&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_MAX_TM&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;primMaxTm&quot;</span><span class="p">,</span><span class="s2">&quot;62&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_INTERNAL_MIN_TM&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inMinTm&quot;</span><span class="p">,</span><span class="s2">&quot;63&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_INTERNAL_OPT_TM&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inOptTm&quot;</span><span class="p">,</span> <span class="s2">&quot;65&quot;</span><span class="p">),</span>
		<span class="s2">&quot;PRIMER_INTERNAL_MAX_TM&quot;</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inMaxTm&quot;</span><span class="p">,</span><span class="s2">&quot;67&quot;</span><span class="p">)</span>
    <span class="p">}</span>  
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="scripts.fur2primer3.write_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_result</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve the sequences from the fasta, reformat them into Primer3-formatted output using the dictionary.</p>

            <details class="quote">
              <summary>Source code in <code>scripts/fur2primer3.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_result</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">Path</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Retrieve the sequences from the fasta, reformat them into Primer3-formatted output using the dictionary.&#39;&#39;&#39;</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
    <span class="n">outfile</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.primers.txt&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEQUENCE_TEMPLATE=</span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>